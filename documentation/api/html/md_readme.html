<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Homie Framework: homie-firmware</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Homie Framework
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">Microcontroller Framework for devices communicationg via MQTT following the Homie Convention</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_readme.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">homie-firmware </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Work in progress update #1</b></p>
<p>Early alpha of my own firmware for my automation projects on ESP8266 and ESP32 platform it is based on the great homie-esp8266 library.</p>
<p>It is still a work in progress but I'm happy like it is working now <b>next:</b> design of the display api</p>
<p><a href="https://homieiot.github.io/"><img src="https://homieiot.github.io/img/works-with-homie.png" alt="works with MQTT Homie" class="inline"/> </a></p>
<h1><a class="anchor" id="autotoc_md23"></a>
intro</h1>
<p>As handy as all the great frameworks like ESPEasy, Tasmota ... sooner or later I had issues with some details. As I use the homie convention for my communication via MQTT the choices are limited too. After several single task projects I decided to start with a new approach collecting all the bits and pieces into my own modular firmware or perhaps I should call it framework?</p>
<p>Perhaps I'm reinventing the wheel here. But why not?</p>
<p><b>Any ideas, comments, issues, help or contributions are welcome.</b></p>
<h1><a class="anchor" id="autotoc_md24"></a>
features</h1>
<ul>
<li>small footprint 400k with 3 plugins (OTA should be possible even on 1MB flash). Will be reduced by removing a lot of debugging log messages.</li>
<li>around 40k free RAM using 3 Nodes with 6 parameters (plenty of headroom for own code). Thy to use <code>PROGMEM</code> wherever possible and useful.</li>
<li>plugins linked on demand (only used plugins go into binary)</li>
<li>build in sample timer per property</li>
<li>threshold value to send data if a property changed</li>
<li>build in timer to send data regardless of a change</li>
<li>oversampling (rolling average to remove noise)</li>
<li>write your own code using c and not a limited scripting interpreter</li>
<li>OTA via MQTT upload thanks to the homie-ESP8266 library (you can use DHCP for your devices)</li>
<li>crash detection (to be improved) to enable OTA even when your code causes an exception resulting in a boot loop</li>
<li>logging to console and syslog. Console logging can switch log level (1..8) and extra info (i,m) by key press.</li>
</ul>
<h1><a class="anchor" id="autotoc_md25"></a>
get started.</h1>
<p>This project is intended to be compiled using <a href="https://platformio.org/">platformIO</a>. I highly recommend using vs-code as your IDE not only because this is the official IDE for platformIO but it is a great tool for beginners and advanced users</p>
<h2><a class="anchor" id="autotoc_md26"></a>
create your on project</h2>
<ul>
<li>create your project in <code>platformio.ini</code> with a unique <code>build_flag</code></li>
<li>add your project into <code>device-xxx.h</code> and include it to your section in the <code>platform.ini</code> file</li>
<li>edit your <code>device-xxx.h</code> file. Here is where all your device specific things should happen.</li>
<li>edit your own <code>config.json</code> with your device configuration (see example)</li>
<li>upload your <code>config.json</code> via usb or flash the initial-upload build to use the config web interface or upload your config using curl</li>
<li>flash your firmware via usb/serial or OTA if you have flashed the initial-upload build</li>
<li>use the serial console or syslog for debugging</li>
</ul>
<h1><a class="anchor" id="autotoc_md27"></a>
platforms</h1>
<ul>
<li>[X] ESP8266 (minimum 1MB flash)</li>
<li>[X] ESP8285 (used in many of the shelf devices, 1MB flash)</li>
<li>[ ] ESP32</li>
</ul>
<h1><a class="anchor" id="autotoc_md28"></a>
modules</h1>
<p>the following list shows the planned and implemented devices. Basically all devices I used before or planning to use in the near future. Think the list grows quickly. Hopefully the ticks too.</p>
<p><b>Update:</b></p><ul>
<li>the API for plugins is more developed.</li>
<li>scheduler works better</li>
<li>device-xxx api is getting stable</li>
<li>log period pwm fading</li>
</ul>
<h2><a class="anchor" id="autotoc_md29"></a>
core</h2>
<ul>
<li>[X] MQTT communication following the homie convention</li>
<li>[X] OTA updates over MQTT with crash detection</li>
<li>[X] unified console logging with dynamic log levels</li>
<li>[X] Syslog event logging for remote logging</li>
<li>[X] two timers per property (sample data and send data)</li>
<li>[X] dynamic data transmission per value threshold. Configurable per property.</li>
<li>[X] data averaging to limit sensor noise. Configurable per property.</li>
<li>[ ] auto sleep / deep sleep based on the timer settings</li>
</ul>
<h2><a class="anchor" id="autotoc_md30"></a>
sensors</h2>
<ul>
<li>[X] ADS1115 4ch 16 bit AD converter</li>
<li>[X] BME280 temperature, humidity and pressure sensor</li>
<li>[X] HDC1080 temperature, humidity sensor</li>
<li>[ ] BME680 air quality (IAQ), temperature, humidity and pressure sensor</li>
<li>[X] BH1750 light sensor (LUX meter)</li>
<li>[ ] HLW8012 mains power sensor</li>
</ul>
<h2><a class="anchor" id="autotoc_md31"></a>
actuators</h2>
<ul>
<li>[X] RELAY / MOSFET switch (GPIO)</li>
<li>[X] DC Motor actuator</li>
<li>[X] LED dimmers, bulbs and strips (PWM)</li>
<li>[ ] RGBW addressable LED</li>
<li>[ ] TUYA serial mcus</li>
</ul>
<h2><a class="anchor" id="autotoc_md32"></a>
human interface devices HID</h2>
<ul>
<li>[ ] RGBW addressable LED (Neopixels)</li>
<li>[ ] ePaper Display</li>
<li>[ ] TFT Matrix display (SPI)</li>
<li>[ ] LCD Matrix display (SPI)</li>
<li>[ ] LCD Character display (I2C)</li>
<li>[ ] OLED Display (I2C)</li>
<li>[X] Push Button</li>
<li>[ ] i2c rotary encoder (with RGB led)</li>
</ul>
<h1><a class="anchor" id="autotoc_md33"></a>
commercial devices</h1>
<ul>
<li>[ ] Sonoff mini / S20 (1xRELAY, Push Button, indicator LED, ESP8285)</li>
<li>[ ] RGBW Light Bulb</li>
<li>[X] H801 5ch 12-24V constant voltage LED (strip) dimmer</li>
<li>[ ] Addressable LED Light Strips (Neopixel)</li>
<li>[ ] TUYA serial dimmers </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
